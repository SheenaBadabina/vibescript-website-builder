<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VibeScript — App</title>
  <meta name="color-scheme" content="dark" />
  <link rel="icon" href="https://vibescript.online/assets/file_0000000034986115891169618f3eb38a.png" type="image/png" />
  <style>
    :root{--bg:#0b1220;--bg2:#0e1729;--card:#111a2a;--text:#e8eefc;--muted:#a9b4ce;--ring:rgba(255,255,255,.12)}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 800px at 50% -15%,#1b1030 0%,#0b1220 55%,#070b14 100%) fixed;color:var(--text);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .shell{min-height:100%;display:grid;grid-template-rows:auto 1fr}
    header{position:sticky;top:0;z-index:10;backdrop-filter:blur(10px);background:color-mix(in oklab,#0b1220 86%, transparent);border-bottom:1px solid var(--ring)}
    .bar{max-width:1120px;margin:0 auto;padding:10px 14px;display:flex;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:28px;height:28px;border-radius:7px;object-fit:cover}
    .grow{margin-left:auto}
    .btn{appearance:none;border:1px solid var(--ring);background:#121b2d;color:#fff;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer}
    .btn:hover{background:#172238}
    main{max-width:1120px;margin:0 auto;padding:16px;display:grid;gap:14px}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:16px;box-shadow:0 10px 28px rgba(0,0,0,.28)}
    h1{margin:.2em 0 .4em;font-size:clamp(22px,7vw,30px)}
    .muted{color:var(--muted)}
    pre{white-space:pre-wrap;background:#0e1729;border:1px solid var(--ring);border-radius:12px;padding:12px;overflow:auto}
    .grid{display:grid;gap:12px}
    @media(min-width:900px){ .grid{grid-template-columns:1.1fr .9fr} }
    /* chakra accent for primary action */
    .btn-cta{border:0;background:linear-gradient(90deg,#ef4444,#f97316,#eab308,#22c55e,#3b82f6,#6366f1,#8b5cf6);background-size:200% 100%}
    .btn-cta:hover{background-position:100% 0}
  </style>
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
</head>
<body>
  <div class="shell">
    <header>
      <div class="bar">
        <div class="brand">
          <img class="logo" src="https://vibescript.online/assets/file_0000000034986115891169618f3eb38a.png" alt="VibeScript" onerror="this.style.display='none'">
          <strong>VibeScript</strong>
        </div>
        <div class="grow"></div>
        <button id="signout" class="btn">Sign out</button>
      </div>
    </header>

    <main>
      <section class="card">
        <p class="muted" style="font-weight:800;letter-spacing:.14em;margin:0 0 6px">WELCOME</p>
        <h1>You're signed in</h1>
        <p class="muted">Below is your session info (email, provider). From here we’ll add the voice-first builder UI.</p>
        <pre id="me">Loading…</pre>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
          <a href="/signin.html" class="btn">Back to sign-in</a>
          <a href="/app/builder-preview.html" class="btn btn-cta">Open Builder Preview</a>
        </div>
      </section>

      <section class="grid">
        <div class="card">
          <h2 style="margin:0 0 6px">Quick actions</h2>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <a class="btn" href="/app/">Refresh</a>
            <button class="btn" id="copy-email">Copy my email</button>
          </div>
        </div>
        <div class="card">
          <h2 style="margin:0 0 6px">Admin</h2>
          <p class="muted" id="admin-note">Checking admin status…</p>
          <div id="admin-actions" style="display:none;gap:10px;flex-wrap:wrap">
            <a class="btn" href="/app/admin/">Go to Admin</a>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const ADMIN_EMAIL = "admin@vibescript.online";

    (async ()=>{
      // Load Supabase config
      const cfg = await fetch("/api/public-env", { cache:"no-store" }).then(r=>r.json()).catch(()=>null);
      if(!cfg || !cfg.url || !cfg.anon){ document.getElementById('me').textContent = "Missing Supabase config."; return; }

      // Init client
      const sb = supabase.createClient(cfg.url, cfg.anon, { auth:{ persistSession:true, autoRefreshToken:true }});

      // Require session
      const { data:{ session } } = await sb.auth.getSession();
      if(!session){ location.replace("/signin.html"); return; }

      // Show session summary
      const user = session.user || {};
      const info = {
        email: user.email || "(unknown)",
        provider: user.app_metadata?.provider || "password",
        email_confirmed_at: user.email_confirmed_at || null,
        user_id: user.id
      };
      document.getElementById('me').textContent = JSON.stringify(info, null, 2);

      // Admin check
      const isAdmin = (user.email||"").toLowerCase() === ADMIN_EMAIL;
      const note = document.getElementById("admin-note");
      const adminBox = document.getElementById("admin-actions");
      if(isAdmin){
        note.textContent = "Admin detected: full privileges.";
        adminBox.style.display = "flex";
      }else{
        note.textContent = "You are signed in as a standard user.";
      }

      // Actions
      document.getElementById("signout").onclick = async ()=>{
        await sb.auth.signOut();
        location.replace("/signin.html");
      };
      document.getElementById("copy-email").onclick = ()=>{
        navigator.clipboard.writeText(user.email||"");
      };
    })();
  </script>
</body>
</html>
