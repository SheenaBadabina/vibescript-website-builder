<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VibeScript Builder — Sign in</title>
  <meta name="description" content="Sign in to VibeScript Builder with email/password or Google." />
  <link rel="icon" href="https://vibescript.online/assets/file_0000000034986115891169618f3eb38a.png" type="image/png" />
  <style>
    :root{--bg:#0a0c10;--card:#0f1218;--text:#eef3ff;--muted:#9fb0c8;--ring:rgba(255,255,255,.18);
      --r:#ef4444;--o:#f97316;--y:#eab308;--g:#22c55e;--b:#3b82f6;--i:#6366f1;--v:#8b5cf6}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.55}
    .wrap{min-height:100%;display:grid;place-items:center;padding:16px}
    .card{width:min(480px,100%);background:var(--card);border:1px solid rgba(159,176,200,.16);border-radius:16px;padding:18px;box-shadow:0 10px 26px rgba(0,0,0,.28)}
    h1{margin:.2em 0 .4em;font-size:clamp(22px,6vw,28px);letter-spacing:-.01em}
    label{display:block;font-size:14px;color:var(--muted);margin:8px 0 6px}
    input{width:100%;background:#0c1117;color:var(--text);border:1px solid rgba(159,176,200,.26);border-radius:12px;padding:12px 14px;font-size:16px}
    input:focus-visible{outline:none;border-color:var(--b);box-shadow:0 0 0 4px rgba(59,130,246,.25)}
    .row{display:grid;gap:10px}
    .btn{width:100%;display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:12px 16px;border-radius:12px;border:1px solid rgba(159,176,200,.28);background:#121826;color:#fff;font-weight:800;cursor:pointer}
    .btn:hover{background:#182030}
    .btn-cta{border:0;background:linear-gradient(90deg,var(--r),var(--o),var(--y),var(--g),var(--b),var(--i),var(--v));background-size:200% 100%}
    .btn-cta:hover{background-position:100% 0}
    .muted{color:var(--muted);font-size:13px}
    .status{margin-top:10px;font-size:14px}
    .ok{color:#86efac}.err{color:#fca5a5}
  </style>
  <!-- Supabase JS (CDN) -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <div style="text-align:center">
        <img alt="VibeScript" src="https://vibescript.online/assets/file_0000000034986115891169618f3eb38a.png" width="40" height="40" style="vertical-align:middle;border-radius:8px" onerror="this.style.display='none'">
        <h1>VibeScript Builder</h1>
        <p class="muted">Sign in with email/password or continue with Google.</p>
      </div>

      <form id="auth" onsubmit="return false">
        <div class="row">
          <div>
            <label for="email">Email</label>
            <input id="email" type="email" inputmode="email" autocomplete="email" placeholder="you@example.com" required>
          </div>
          <div>
            <label for="password">Password</label>
            <input id="password" type="password" autocomplete="current-password" placeholder="••••••••" required>
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <button class="btn btn-cta" id="btn-signin" type="button">Sign in</button>
          <button class="btn" id="btn-signup" type="button">Create account</button>
          <button class="btn" id="btn-google" type="button">Continue with Google</button>
        </div>
        <div id="status" class="status" aria-live="polite"></div>
      </form>

      <p class="muted" style="margin-top:16px">By continuing you agree to our terms and privacy policy.</p>
    </section>
  </main>

  <script>
    // env from Cloudflare Pages
    const SUPABASE_URL = (window.SUPABASE_URL || "${SUPABASE_URL}").replace("${SUPABASE_URL}","") || (typeof SUPABASE_URL!=="undefined"?SUPABASE_URL:"");
    const SUPABASE_ANON_KEY = (window.SUPABASE_ANON_KEY || "${SUPABASE_ANON_KEY}").replace("${SUPABASE_ANON_KEY}","") || (typeof SUPABASE_ANON_KEY!=="undefined"?SUPABASE_ANON_KEY:"");

    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: true }
    });

    const $ = (id)=>document.getElementById(id);
    const statusEl = $("status");
    function setStatus(msg, ok){ statusEl.className = "status " + (ok ? "ok" : "err"); statusEl.textContent = msg; }

    $("btn-signin").onclick = async ()=>{
      const email = $("email").value.trim(), password = $("password").value;
      if(!email || !password) return setStatus("Enter email and password.", false);
      setStatus("Signing in…");
      const { error } = await sb.auth.signInWithPassword({ email, password });
      if(error) return setStatus(error.message, false);
      location.href = "/app/";
    };

    $("btn-signup").onclick = async ()=>{
      const email = $("email").value.trim(), password = $("password").value;
      if(!email || !password) return setStatus("Enter email and password.", false);
      setStatus("Creating account… check your inbox to confirm.");
      const { error } = await sb.auth.signUp({ email, password, options: { emailRedirectTo: location.origin + "/app/" }});
      if(error) return setStatus(error.message, false);
      setStatus("Account created. Please confirm via email, then return here.", true);
    };

    $("btn-google").onclick = async ()=>{
      setStatus("Opening Google…");
      const { data, error } = await sb.auth.signInWithOAuth({
        provider: "google",
        options: { redirectTo: location.origin + "/app/" }
      });
      if(error) return setStatus(error.message, false);
      // Supabase will redirect
    };

    // If already logged in, jump to app
    (async ()=>{
      const { data:{ session } } = await sb.auth.getSession();
      if(session) location.replace("/app/");
    })();
  </script>
</body>
</html>
